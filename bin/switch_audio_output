#!/usr/bin/env bash

# set -euo pipefail

PREFERRED_DEVICES=("Samson GoMic" "megabose" "")

AVAILABLE_OUTPUTS=$(SwitchAudioSource -a -t output)

if [ -n "$1" ]; then
  echo "Adding $1 to available outputs"
  AVAILABLE_OUTPUTS="$AVAILABLE_OUTPUTS"$'\n'"$1"
fi

echo "Available outputs: $AVAILABLE_OUTPUTS"

for DEVICE in "${PREFERRED_DEVICES[@]}"; do
  if echo "$AVAILABLE_OUTPUTS" | grep -q "$DEVICE"; then
    SwitchAudioSource -t output -s "$DEVICE"
    osascript -e "display notification \"Output switched to $DEVICE\" with title \"Audio Output\""
    exit 0
  fi
done

SwitchAudioSource -t output -s "MacBook Pro Speakers"
osascript -e "display notification \"Output switched to default: MacBook Pro Speakers\" with title \"Audio Output\""
